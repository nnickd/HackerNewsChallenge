<div 
    class="stories" 
    appKeyboardShortcuts 
    [shortcutsDisabled]="loading" 
    (focusTarget)="focusInput()" 
    (prevPage)="prevPage()" 
    (nextPage)="nextPage()"
    (nextItem)="onNextItem()"
    (prevItem)="onPrevItem()"
    (escape)="onEscape()">
    <h1>Hacker News</h1>

    <div class="controls">
        <input #searchInput type="text" placeholder="Search stories..." [(ngModel)]="query"
            (ngModelChange)="onSearchChange($event)" />

        <div class="paging">
            <button (click)="prevPage()" [disabled]="page <= 1 || loading">Prev</button>
            <span>Page {{ page }}</span>
            <button (click)="nextPage()" [disabled]="loading || stories.length < pageSize">Next</button>
        </div>
    </div>

    <div class="story-list" [class.crt-loading]="showLoading" [class.no-stories]="!stories.length || error">
        @if (showLoading && !stories.length) {
            <p>Loading storiesâ€¦</p>
        } @else if (error) {
            <p class="error">{{ error }}</p>
        } @else {
            @if (stories.length > 0) {
                <ul>
                    @for (s of stories; track s.id; let idx = $index) {
                        <li>
                            <div class="story-title">
                                <span class="story-score">&lt;{{ s.score ?? 0 }}&gt;</span>
                                <a 
                                   #storyLink 
                                   [href]="s.link" 
                                   target="_blank" 
                                   rel="noopener noreferrer"
                                   [attr.tabindex]="idx === activeIdx ? 0 : -1"
                                   [class.active]="idx === activeIdx && itemNav">
                                      @for (part of (s.title | highlight: query); track $index) {
                                        <span [class.highlight]="part.match">{{ part.text }}</span>
                                      }
                                </a>
                            </div>
                            <div class="story-details">
                                @if (s.by) { 
                                    <span>{{ s.by }}</span> 
                                }
                                <span class="story-date">@</span>
                                <span>{{ s.createdAt | date:'short' }}</span>
                            </div>
                        </li>
                    }
                </ul>
            } 
            @else if (!loading) {
                <p>No stories found.</p>
            }
        }
    </div>
</div>